# Approve Idea and Create GitHub Issue

Create a GitHub issue from a generated idea.

## Arguments
- `$ARGUMENTS` - Required: idea ID (e.g., `3` or `3,5,7` for multiple)

## Prerequisites

- GitHub CLI (`gh`) must be installed and authenticated
- Repository must be connected to GitHub

Check with:
```bash
gh auth status
gh repo view --json nameWithOwner
```

## Instructions

1. **Validate GitHub CLI:**
   ```bash
   gh auth status
   ```
   
   If not authenticated:
   ```
   ‚ùå GitHub CLI not authenticated.
   
   Run: gh auth login
   Then try again.
   ```

2. **Load the idea:**
   ```bash
   cat .branch-flow/ideas/ideas.json | jq '.ideas[] | select(.id == 3)'
   ```
   
   If idea not found:
   ```
   ‚ùå Idea #3 not found. Run /bf:ideas to see available ideas.
   ```

3. **Map category to GitHub label:**

   | Category | GitHub Label |
   |----------|--------------|
   | code | `code-quality`, `refactor` |
   | security | `security`, `priority:high` (if high) |
   | uiux | `ui/ux`, `enhancement` |
   | docs | `documentation` |
   | performance | `performance`, `optimization` |

4. **Map priority to GitHub label:**

   | Priority | GitHub Label |
   |----------|--------------|
   | high / major | `priority:high` |
   | medium | `priority:medium` |
   | low / minor | `priority:low` |

5. **Create the GitHub issue:**

   ```bash
   gh issue create \
     --title "Idea: Remove hardcoded Google Maps API key from frontend code" \
     --body "## Description

   The Google Maps API key 'AIzaSy...' is hardcoded directly in the frontend component AuditDetail.vue (line 172). This key is exposed in the client-side code and can be extracted by anyone viewing the source.

   ## Category
   üîí Security

   ## Priority
   High

   ## Affected Files
   - src/components/AuditDetail.vue (line 172)

   ## Suggested Approach
   1. Move API key to environment variable
   2. Use .env file for local development
   3. Configure CI/CD to inject production key

   ---
   *Generated by Branch Flow ideation*" \
     --label "security" \
     --label "priority:high"
   ```

6. **Capture the issue number:**
   ```bash
   # gh issue create returns the URL, extract number
   # e.g., https://github.com/user/repo/issues/45 ‚Üí 45
   ```

7. **Update ideas.json:**
   ```json
   {
     "id": 3,
     "status": "approved",
     "github_issue": 45,
     "approved_at": "2025-01-19T17:00:00Z"
   }
   ```

8. **Output:**
   ```
   ‚úÖ GitHub Issue Created!

   Issue:    #45
   Title:    Remove hardcoded Google Maps API key from frontend code
   URL:      https://github.com/user/repo/issues/45
   Labels:   security, priority:high

   Next steps:
     /bf:spec "Fix #45 - Remove hardcoded API key"
     
   Or work directly:
     git checkout -b fix/45-remove-api-key
   ```

## Creating Multiple Issues

```bash
/bf:idea-approve 3,5,7
```

Creates issues for ideas 3, 5, and 7:

```
‚úÖ Created 3 GitHub Issues:

   #45 - Remove hardcoded Google Maps API key (idea #3)
   #46 - Implement route guards for authenticated routes (idea #5)  
   #47 - Sanitize HTML content to prevent XSS (idea #7)

Issues are now tracked in GitHub and ideas marked as approved.
```

## Issue Body Template

The GitHub issue body follows this structure:

```markdown
## Description

[Detailed description from idea]

## Category

[Icon] [Category Name]

## Priority

[Priority level]

## Affected Files

- file1.js (line X)
- file2.vue

## Effort Estimate

[small/medium/large]

## Suggested Approach

[If available, brief suggestion on how to fix]

## Acceptance Criteria

- [ ] [Specific criteria based on the issue]
- [ ] Tests pass
- [ ] No new warnings

---
*Generated by Branch Flow ideation ¬∑ Idea #[id]*
```

## Label Auto-Creation

If labels don't exist in the repo, create them:

```bash
gh label create "priority:high" --color "d73a4a" --description "High priority"
gh label create "priority:medium" --color "fbca04" --description "Medium priority"
gh label create "priority:low" --color "0e8a16" --description "Low priority"
gh label create "code-quality" --color "5319e7" --description "Code quality improvement"
gh label create "security" --color "d73a4a" --description "Security issue"
gh label create "ui/ux" --color "1d76db" --description "UI/UX improvement"
gh label create "documentation" --color "0075ca" --description "Documentation"
gh label create "performance" --color "f9d0c4" --description "Performance optimization"
```

## Integration with Branch Flow

After creating an issue, the natural workflow is:

```bash
/bf:spec "Fix #45 - Remove hardcoded API key"
# Claude creates spec referencing issue #45

/bf:plan
# Plan references issue, will close it on merge

/bf:build
# Creates branch: bf/004-fix-45-remove-api-key

/bf:merge
# PR description includes "Closes #45"
# Issue auto-closes when merged
```

## Skipping Issue Creation

If you want to work on an idea without creating a GitHub issue:

```bash
/bf:spec "Remove hardcoded API key (from idea #3)"
```

This creates a spec directly without the GitHub issue tracking.
